<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>Order Statistics</title>

<script src="OrderStatistics_files/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="OrderStatistics_files/bootstrap-3.3.1/css/bootstrap.min.css" rel="stylesheet" />
<script src="OrderStatistics_files/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="OrderStatistics_files/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="OrderStatistics_files/bootstrap-3.3.1/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="OrderStatistics_files/highlight/default.css"
      type="text/css" />
<script src="OrderStatistics_files/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">


<div id="header">
<h1 class="title">Order Statistics</h1>
</div>


<div id="tldr" class="section level3">
<h3>tl;dr</h3>
<p>Use second worst miss radius measured from the target center.</p>
</div>
<div id="motivational-example" class="section level3">
<h3>Motivational Example</h3>
<p>You borrow a rifle for the hunt. The owner says it is zeroed and you trust him. But you don’t know how well you can shoot this rifle, or how your ammo performs in it. You want to determine how big a target you can hit, or equivalently how far you can hit a target of a given size. For simplicity assume <del>spherical horse in vacuum</del> that the target is round and the distance is small enough that you don’t have to worry about holdovers and can ignore wind.</p>
<p>By the way, this is what professional hunters do when they bring their client to the range the day before the hunt to “zero the rifle”. They know the rifle is zeroed. They want to know how close they need to get this particular client to the game animal for the hunt to be successful.</p>
</div>
<div id="metric-choice" class="section level3">
<h3>Metric Choice</h3>
<p>One metric particularly useful in practice is <span class="math">\(R_{90}\)</span>: the radius of a circle that is expected to contain 90% of all impacts.</p>
<p>This choice is a compromise. <span class="math">\(R_{100}\)</span> is much easier to estimate, but knowing the trivial fact that <span class="math">\(R_{100}=\infty\)</span> does not help much. Given available number of shots, there would not be enough tail events to determine <span class="math">\(R_{99}\)</span> or even <span class="math">\(R_{95}\)</span> with sufficient accuracy. From the other side, <span class="math">\(R_{50}\)</span> aka CEP might be reasonable for military applications, but is too low for civilian use.</p>
<p>In theory it’s easy to convert between different metrics, but in practice it’s better to have a way to get the metric you want directly with the least amount of math to be done in the field.</p>
<p>One nice side effect of choosing <span class="math">\(R_{90}\)</span> is that it allows to sidestep the tricky outlier/flier/defect question. We simply decide to not care about the few worst shots, regardless of the reason. And if fliers are more frequent, they probably aren’t really fliers.</p>
<p>So you go to the range, set up some paper targets at typical engagement range, shoot at them, and look at the results.</p>
</div>
<div id="one-shot---summary" class="section level3">
<h3>One Shot - Summary</h3>
<p>Even one shot is better than nothing. If miss radius (the distance between target center and impact) is <span class="math">\(R_{1:1}\)</span>, then estimated <span class="math">\(R_{90}\)</span> is</p>
<p><span class="math">\[\hat{R_{90}} = 3 R_{1:1}\]</span></p>
<p>In examples below red circle has radius <span class="math">\(R_{1:1}\)</span> and blue circle has radius <span class="math">\(\hat{R_{90}}\)</span>.</p>
<p><img src="OrderStatistics_files/figure-html/fig_1-1.png" title="" alt="" width="900" /></p>
<p>All impact coordinates were pulled from the same standard bivariate normal distribution, but the circles look very different in size, which means that the variance of the estimate is quite high.</p>
</div>
<div id="one-shot---rationale" class="section level3">
<h3>One Shot - Rationale</h3>
<p>Here’s the math behind the magic number 3. Assume miss radiuses of individual shots follow Rayleigh distribution with <span class="math">\(\sigma = 1\)</span>. Its probability density function is</p>
<p><span class="math">\[f(x)=x e^{-\frac{x^2}{2}}\]</span></p>
<p>and cumulative distribution function is</p>
<p><span class="math">\[F(x)=1-e^{-\frac{x^2}{2}}\]</span></p>
<p><span class="math">\(x\)</span> here is miss radius rather than horizontal coordinate. <span class="math">\(R_{90}\)</span> and <span class="math">\(x\)</span> are measured in the same units and there are no other factors involved, so <span class="math">\(R_{90}\)</span> should be proportional to <span class="math">\(x\)</span> with some yet unknown dimensionless coefficient <span class="math">\(k\)</span>. Probability that miss radius of the next shot is greater than <span class="math">\(kx\)</span> (complementary cumulative distribution function) is</p>
<p><span class="math">\[1-F(kx) = e^{-\frac{k^2 x^2}{2}}\]</span></p>
<p>Integrating over all values of <span class="math">\(x\)</span> gives total probability of the next miss radius exceeding <span class="math">\(R_{90}\)</span>, which should be equal to 0.1:</p>
<p><span class="math">\[\int_{0}^{\infty}f(x)\left(1-F(kx)\right) dx = \int_{0}^{\infty}x e^{-\frac{x^2}{2}} e^{-\frac{k^2 x^2}{2}} dx = 0.1\]</span></p>
<p>This equation is easy to solve on paper, but it will soon get more interesitng so why not warm <a href="http://maxima.sourceforge.net">Maxima</a> up now to find <span class="math">\(k\)</span>.</p>
<pre class="maxima"><code>find_root(integrate(x*exp(-x^2/2)*exp(-k^2*x^2/2), x, 0, inf)=0.1, k, 1, 10);
3.0</code></pre>
</div>
<div id="three-shots---summary" class="section level3">
<h3>Three Shots - Summary</h3>
<p>If worst miss radius in the three-shot group is <span class="math">\(R_{3:3}\)</span>, then</p>
<p><span class="math">\[\hat{R_{90}} = \sqrt{2} R_{3:3} \approx 1.4 R_{3:3}\]</span></p>
<p>In examples below red circle has radius <span class="math">\(R_{3:3}\)</span> and blue circle has radius <span class="math">\(\hat{R_{90}}\)</span>.</p>
<p><img src="OrderStatistics_files/figure-html/fig_3-1.png" title="" alt="" width="900" /></p>
</div>
<div id="three-shots---rationale" class="section level3">
<h3>Three Shots - Rationale</h3>
<p>Here’s where <span class="math">\(\sqrt{2}\)</span> comes from. Probability density of <span class="math">\(m\)</span>th miss radius in a group of <span class="math">\(n\)</span> shots is</p>
<p><span class="math">\[f_{m:n}(x)=\frac{n!}{(m-1)!(n-m)!}\left(F(x)\right)^{m-1}\left(1-F(x)\right)^{n-m}f(x)\]</span></p>
<p>For <span class="math">\(m=3\)</span> and <span class="math">\(n=3\)</span></p>
<p><span class="math">\[f_{3:3}(x)=\frac{3!}{(3-1)!(3-3)!}\left(F(x)\right)^{3-1}\left(1-F(x)\right)^{3-3}f(x)=3\left(F(x)\right)^{2}f(x)=3\left(1-e^{-\frac{x^2}{2}}\right)^{2} x e^{-\frac{x^2}{2}}\]</span></p>
<p>Integrating over all values of <span class="math">\(x\)</span></p>
<p><span class="math">\[\int_{0}^{\infty}f_{3:3}(x) (1-F(kx)) dx = \int_{0}^{\infty}3\left(1-e^{-\frac{x^2}{2}}\right)^{2} x e^{-\frac{x^2}{2}} e^{-\frac{k^2 x^2}{2}} dx = 0.1\]</span></p>
<p>Solving for <span class="math">\(k\)</span>, we get</p>
<pre class="maxima"><code>find_root(integrate(3*(1-exp(-x^2/2))^2*x*exp(-x^2/2)*exp(-k^2*x^2/2), x, 0, inf)=0.1, k, 1, 10);
1.414213562373095</code></pre>
</div>
<div id="five-shots---summary" class="section level3">
<h3>Five Shots - Summary</h3>
<p>So far we have ignored the issue of outliers (fliers), but with five or more shots we can finally do something about them: look at the <em>second worst</em> miss radius instead of the worst miss radius.</p>
<p><span class="math">\[\hat{R_{90}} \approx 1.6 R_{4:5}\]</span></p>
<p>In examples below red circle has radius <span class="math">\(R_{4:5}\)</span> (4<sup>th</sup>-smallest miss radius in a 5-shot group), and blue circle has radius <span class="math">\(\hat{R_{90}}\)</span>.</p>
<p><img src="OrderStatistics_files/figure-html/fig_5-1.png" title="" alt="" width="900" /></p>
</div>
<div id="five-shots---rationale" class="section level3">
<h3>Five Shots - Rationale</h3>
<p>According to formula 3.13 in M. M. Siddiqui 1964 paper referenced in Prior Art, optimum unbiased estimator from single order statistic <span class="math">\(R_{m:n}\)</span> is</p>
<p><span class="math">\[m \approx 0.79681(n+1)-0.39841+\frac{1.16312}{n+1}\]</span></p>
<p>For <span class="math">\(n=5\)</span> optimum estimator is <span class="math">\(m=5\)</span>, but <span class="math">\(m=4\)</span> is not far behind and is less sensitive to outliers.</p>
<p>Probability density of <span class="math">\(m\)</span>th miss radius in a group of <span class="math">\(n\)</span> shots is</p>
<p><span class="math">\[f_{m:n}(x)=\frac{n!}{(m-1)!(n-m)!}\left(F(x)\right)^{m-1}\left(1-F(x)\right)^{n-m}f(x)\]</span></p>
<p>For <span class="math">\(m=4\)</span> and <span class="math">\(n=5\)</span></p>
<p><span class="math">\[f_{4:5}(x)=\frac{5!}{(4-1)!(5-4)!}\left(F(x)\right)^{4-1}\left(1-F(x)\right)^{5-4}f(x)=20\left(F(x)\right)^{3}\left(1-F(x)\right)f(x)\]</span> <span class="math">\[=20\left(1-e^{-\frac{x^2}{2}}\right)^{3} e^{-\frac{x^2}{2}} x e^{-\frac{x^2}{2}}\]</span></p>
<p>Integrating over all values of <span class="math">\(x\)</span></p>
<p><span class="math">\[\int_{0}^{\infty}f_{4:5}(x) (1-F(kx)) dx = \int_{0}^{\infty} 20\left(1-e^{-\frac{x^2}{2}}\right)^{3} e^{-\frac{x^2}{2}} x e^{-\frac{x^2}{2}} x e^{-\frac{k^2 x^2}{2}} dx = 0.1\]</span></p>
<p>Solving for <span class="math">\(k\)</span></p>
<pre class="maxima"><code>f45(x):=20*(1-exp(-x^2/2))^3*x*exp(-x^2);
find_root(integrate(f45(u)*exp(-k^2*u^2/2),u,0,inf)=0.1, k, 1, 2);
1.578643529936508</code></pre>
</div>
<div id="ten-shots---summary" class="section level3">
<h3>Ten Shots - Summary</h3>
<p>We can simply split ten shots into two five-shot groups and take the average, but adding 6th and 9th miss radiuses works even better:</p>
<p><span class="math">\[\hat{R_{90}} \approx 0.7 (R_{6:10} + R_{9:10})\]</span></p>
<p>In examples below the two red circles have radiuses <span class="math">\(R_{6:10}\)</span> and <span class="math">\(R_{9:10}\)</span>, and blue circle has radius <span class="math">\(\hat{R_{90}}\)</span>.</p>
<p><img src="OrderStatistics_files/figure-html/fig_10-1.png" title="" alt="" width="900" /></p>
</div>
<div id="ten-shots---rationale" class="section level3">
<h3>Ten Shots - Rationale</h3>
<p>According to M. M. Siddiqui 1964 paper referenced in Prior Art, the two optimal order statistics are <span class="math">\(0.639(n+1)\)</span> and <span class="math">\(0.927(n+1)\)</span>. For <span class="math">\(n=10\)</span> it’s 7 and 10, but 6 and 9 work nearly as well. Not using the worst miss radius means that R<sub>6:10</sub> + R<sub>9:10</sub> is a more robust estimator.</p>
<p>Joint probability distribution of 6<sup>th</sup> miss radius <span class="math">\(x=R_{6:10}\)</span> and 9<sup>th</sup> miss radius <span class="math">\(y=R_{9:10}\)</span> is</p>
<p><span class="math">\[f(x,y)=\frac{n!}{(j-1)!(k-j-1)!(n-k)!}\left[F(x)\right]^{j-1}\left(F(y)-F(x)\right)^{k-j-1}\left(1-F(y)\right)^{n-k}f(x)f(y)\]</span> <span class="math">\[=15120 \left[1-e^{-\frac{x^2}{2}}\right]^5 \left(e^{-\frac{x^2}{2}}-e^{-\frac{y^2}{2}}\right)^2 e^{-\frac{y^2}{2}} x e^{-\frac{x^2}{2}} y e^{-\frac{y^2}{2}}, x \le y\]</span></p>
<p>Since we only care about <span class="math">\(x+y\)</span>, we can rotate axes by 45° and integrate over <span class="math">\(x-y\)</span>:</p>
<p><span class="math">\[p(u)=\frac{1}{2}\int_{0}^{u}f\left(\frac{u-v}{2},\frac{u+v}{2}\right)dv\]</span></p>
<p>Integrating over all values of <span class="math">\(u\)</span></p>
<p><span class="math">\[\int_{0}^{\infty}p(u)e^{-\frac{k^2 u^2}{2}}du = 0.1\]</span></p>
<p>This seems to be too hard even for Maxima to solve analytically, so we’ll have to resort to numeric integration using <a href="https://en.wikipedia.org/wiki/Romberg%27s_method">Romberg’s method</a>. Upper limit of 10 instead of <span class="math">\(\infty\)</span> in second integration prevents underflow in the tail.</p>
<pre class="maxima"><code>f(x,y):=15120*(1-exp(-x^2/2))^5*(exp(-x^2/2)-exp(-y^2/2))^2*exp(-y^2/2)*x*exp(-x^2/2)*y*exp(-y^2/2);
p(u):=romberg(f((u-v)/2,(u+v)/2)/2,v,0,u);
find_root(romberg(p(u)*exp(-k^2*u^2/2),u,0,10)=0.1,k,0.6,0.8);
0.70766872521906</code></pre>
</div>
<div id="multiple-groups---summary" class="section level3">
<h3>Multiple Groups - Summary</h3>
<p>With more than ten shots, it’s easier to split them into five- or ten-shot groups and take the average. The factors will be somewhat smaller:</p>
<p><span class="math">\[\hat{R_{90}} \approx 1.4 R_{4:5} \approx 0.67 (R_{6:10} + R_{9:10})\]</span></p>
</div>
<div id="multiple-groups---rationale" class="section level3">
<h3>Multiple Groups - Rationale</h3>
<p>With very large number of groups, the factors are just ratios of expected values:</p>
<p><span class="math">\[\frac{E(R_{90})}{E(R_{4:5})}\]</span></p>
<pre class="maxima"><code>f45(x):=20*(1-exp(-x^2/2))^3*x*exp(-x^2);
float(sqrt(2*log(10))/integrate(x*f45(x), x, 0, inf))
1.38619009633813</code></pre>
<p><span class="math">\[\frac{E(R_{90})}{E(R_{6:10})+E(R_{9:10})}\]</span></p>
<pre class="maxima"><code>f610(x):=1260*(1-exp(-x^2/2))^5*exp(-2*x^2)*x*exp(-x^2/2);
f910(x):=90*(1-exp(-x^2/2))^8*x*exp(-x^2);
float(sqrt(2*log(10))/(integrate(x*f610(x),x,0,inf)+integrate(x*f910(x),x,0,inf)));
0.6702446399176036</code></pre>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
